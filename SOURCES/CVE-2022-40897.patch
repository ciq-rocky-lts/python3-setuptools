Orabug: 35034581
CVE-2022-40897 fix missing from python3-setuptools 

This is a direct back port from the OL8 patch for the fixes to
CVE-2022-40897.

Signed-off-by: Isaac Chen <isaac.chen@oracle.com>
Reviewed-by: Laurence Rochfort <laurence.rochfort@oracle.com>

diff -up setuptools-39.2.0/setuptools/package_index.py.orig setuptools-39.2.0/setuptools/package_index.py
--- setuptools-39.2.0/setuptools/package_index.py.orig	2023-04-20 17:36:52.085959031 -0700
+++ setuptools-39.2.0/setuptools/package_index.py	2023-04-20 22:13:18.621395300 -0700
@@ -213,6 +213,7 @@ def unique_values(func):
 
 
 REL = re.compile(r"""<([^>]*\srel\s*=\s*['"]?([^'">]+)[^>]*)>""", re.I)
+REL = re.compile(r"""<([^>]*\srel\s{0,10}=\s{0,10}['"]?([^'" >]+)[^>]*)>""", re.I)
 # this line is here to fix emacs' cruddy broken syntax highlighting
 
 
diff -up setuptools-39.2.0/setuptools/tests/test_packageindex.py.orig setuptools-39.2.0/setuptools/tests/test_packageindex.py
--- setuptools-39.2.0/setuptools/tests/test_packageindex.py.orig	2023-04-20 17:38:28.928967417 -0700
+++ setuptools-39.2.0/setuptools/tests/test_packageindex.py	2023-04-20 22:17:36.270417610 -0700
@@ -223,6 +223,12 @@ class TestPackageIndex:
             assert dists[0].version == ''
             assert dists[1].version == vc
 
+    def test_REL_DoS(self):
+        """
+        REL should not hang on a contrived attack string.
+        """
+        setuptools.package_index.REL.search('< rel=' + ' ' * 2**12)
+
 
 class TestContentCheckers:
     def test_md5(self):
